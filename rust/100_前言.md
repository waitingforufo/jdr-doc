#### æƒ³è¦å¼€å‘windowsä¸Šä¸linuxä¸Šéƒ½èƒ½è¿è¡Œçš„rustç¨‹åºï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿ

åœ¨ Rust ä¸­å¼€å‘åŒæ—¶å…¼å®¹ Windows å’Œ Linux çš„ç¨‹åºï¼Œæ ¸å¿ƒæ˜¯**ç¼–å†™è·¨å¹³å°ä»£ç **ã€**ç®¡ç†å¹³å°å·®å¼‚**ï¼Œå¹¶å»ºç«‹**è·¨å¹³å°æ„å»ºä¸æµ‹è¯•æµç¨‹**ã€‚ä»¥ä¸‹æ˜¯ä»ç¯å¢ƒæ­å»ºåˆ°ä»£ç ç¼–å†™çš„å®Œæ•´å®è·µæŒ‡å—ã€‚

### ğŸ—ï¸ ç¬¬ä¸€æ­¥ï¼šæ­å»ºè·¨å¹³å°å¼€å‘ç¯å¢ƒ

å·²æ‹¥æœ‰ **WSLï¼ˆUbuntuï¼‰**ï¼Œè¿™æ˜¯ç»ä½³çš„è·¨å¹³å°å¼€å‘èµ·ç‚¹ã€‚è¯·æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡ä½ çš„å·¥ä½œç¯å¢ƒï¼š

| ç¯å¢ƒç»„ä»¶ | åœ¨ WSL (Ubuntu) ä¸­ | åœ¨ Windows ä¸»æœºä¸­ | åä½œå…³ç³» |
| :--- | :--- | :--- | :--- |
| **ä»£ç å­˜å‚¨** | é¡¹ç›®ä½äº WSL æ–‡ä»¶ç³»ç»Ÿ (å¦‚ `/home/you/projects/`) | é€šè¿‡ `\\wsl$\Ubuntu\...` è®¿é—® | **åŒä¸€ä»½æºç **ï¼ŒåŒç«¯å¯è¯»å†™ã€‚ |
| **Rust å·¥å…·é“¾** | é€šè¿‡ `rustup` å®‰è£…ï¼Œé»˜è®¤ `x86_64-unknown-linux-gnu` | é€šè¿‡ `rustup` å®‰è£…ï¼Œé»˜è®¤ `x86_64-pc-windows-msvc` | å·¥å…·é“¾ç‹¬ç«‹ï¼Œä½† `rustup` å‘½ä»¤åœ¨ä¸¤ç«¯é€šç”¨ã€‚ |
| **IDE** | å¯å®‰è£… RustRover for Linux* (å¯é€‰) | ä½¿ç”¨ RustRover for Windowsï¼Œå¹¶**é€šè¿‡WSLå·¥å…·é“¾æ‰“å¼€é¡¹ç›®** (æ¨è) | **æœ€ä½³å®è·µ**ï¼šåœ¨Windows RustRoverä¸­æ“ä½œï¼Œäº«å—å®Œæ•´GUIï¼Œç¼–è¯‘ä»»åŠ¡äº¤ç»™WSLã€‚ |
| **ç»ˆç«¯/æ„å»º** | WSL ç»ˆç«¯ (`bash`, `zsh`) | Windows ç»ˆç«¯ã€PowerShellã€æˆ–IDEå†…åµŒçš„WSLç»ˆç«¯ | åœ¨IDEæˆ–Windowsç»ˆç«¯ä¸­å¯åŠ¨WSLç»ˆç«¯æ‰§è¡Œå‘½ä»¤ã€‚ |

> *æ³¨ï¼šä¹Ÿå¯ä»¥åœ¨WSLå†…å®‰è£…Linuxç‰ˆRustRoverå¹¶ä½¿ç”¨GUIï¼Œä½†é…ç½®ç¨å¤æ‚ï¼Œé€šå¸¸ä¸æ¨èã€‚

**å…·ä½“æ“ä½œ**ï¼š
1.  **ç¡®ä¿Windowsä¸»æœºå·²å®‰è£…Rust**ï¼šæ‰“å¼€Windowsç»ˆç«¯ï¼ˆPowerShellæˆ–CMDï¼‰ï¼Œè¿è¡Œ `rustup --version`ã€‚å¦‚æœæœªå®‰è£…ï¼Œè¯·è®¿é—® [rustup.rs](https://rustup.rs/) å®‰è£…Windowsç‰ˆã€‚

2.  **é…ç½®RustRoverä½¿ç”¨WSLå·¥å…·é“¾**ï¼ˆå»¶ç»­ä¹‹å‰è®¾ç½®ï¼‰ï¼šåœ¨RustRoverçš„ **File | Settings | Build, Execution, Deployment | Toolchains** ä¸­ï¼Œç¡®ä¿å·²æˆåŠŸæ·»åŠ WSLå·¥å…·é“¾ï¼ˆç›®æ ‡ä¸ºLinuxï¼‰ã€‚è¿™æ˜¯ä½ å¼€å‘ã€ç¼–è¯‘å’Œè°ƒè¯•ï¼ˆé’ˆå¯¹Linuxï¼‰çš„ä¸»è¦ç¯å¢ƒã€‚

3.  **ä¸ºWindowsæ·»åŠ ç¼–è¯‘ç›®æ ‡**ï¼ˆåœ¨WSLä¸­ï¼‰ï¼šå³ä¾¿åœ¨WSLé‡Œå¼€å‘ï¼Œä½ ä¹Ÿå¯ä»¥**ç›´æ¥ç¼–è¯‘å‡ºWindowså¯æ‰§è¡Œæ–‡ä»¶**ï¼ˆäº¤å‰ç¼–è¯‘ï¼‰ã€‚åœ¨WSLç»ˆç«¯ä¸­è¿è¡Œï¼š
    ```bash
    # æ·»åŠ  Windows 64ä½ GNU ç›®æ ‡å·¥å…·é“¾ï¼ˆä¸MinGWå…¼å®¹ï¼Œéƒ¨ç½²æ›´ç®€å•ï¼‰
    rustup target add x86_64-pc-windows-gnu
    # æˆ–æ·»åŠ  MSVC ç›®æ ‡ï¼ˆè‹¥éœ€ä¸WindowsåŸç”Ÿåº“äº¤äº’ï¼‰
    # rustup target add x86_64-pc-windows-msvc
    ```
    æ­¤æ—¶ï¼ŒWSLç¯å¢ƒå°±å…·å¤‡äº†ä¸ºä¸¤ä¸ªå¹³å°ç¼–è¯‘çš„èƒ½åŠ›ã€‚

### ğŸ“¦ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºé¡¹ç›®ä¸å¤„ç†è·¨å¹³å°ä»£ç 

1.  **åˆ›å»ºæ–°é¡¹ç›®**ï¼ˆåœ¨WSLç»ˆç«¯ä¸­ï¼‰ï¼š
    ```bash
    cargo new my_cross_platform_app
    cd my_cross_platform_app
    ```
2.  **ç¼–å†™è·¨å¹³å°ä»£ç çš„æ ¸å¿ƒç­–ç•¥**ï¼š

    *   **ä¼˜å…ˆä½¿ç”¨Rustæ ‡å‡†åº“ (`std`)**ï¼šå…¶å¯¹æ–‡ä»¶ã€ç½‘ç»œã€çº¿ç¨‹ç­‰æ“ä½œå·²åšäº†å¤§é‡è·¨å¹³å°æŠ½è±¡ï¼Œå¤šæ•°æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨å³å¯ã€‚
    *   **ä½¿ç”¨æ¡ä»¶ç¼–è¯‘ (`#[cfg(...)]`)** å¤„ç†**å¿…ç„¶çš„å¹³å°å·®å¼‚**ï¼Œä¾‹å¦‚è°ƒç”¨ç‰¹å®šAPIæˆ–ä½¿ç”¨ä¸åŒçš„ä¾èµ–ã€‚è¿™æ˜¯æœ€æ ¸å¿ƒçš„æ‰‹æ®µã€‚

    **ä»£ç ç¤ºä¾‹ (`src/main.rs`)**ï¼š
    ```rust
    use std::error::Error;

    // 1. æ¡ä»¶ç¼–è¯‘ï¼šå£°æ˜ç‰¹å®šå¹³å°çš„ä¾èµ–æˆ–æ¨¡å—
    #[cfg(target_os = "windows")]
    mod windows_utils;

    #[cfg(target_os = "linux")]
    mod linux_utils;

    // 2. æ¡ä»¶ç¼–è¯‘ï¼šå®ç°ç‰¹å®šå¹³å°å‡½æ•°
    fn get_platform_info() -> String {
        #[cfg(target_os = "windows")]
        {
            format!("Windows (OS version info placeholder)").into()
            // å®è·µä¸­å¯è°ƒç”¨ windows_utils::get_version()
        }
        #[cfg(target_os = "linux")]
        {
            // ç¤ºä¾‹ï¼šè¯»å–Linuxç³»ç»Ÿä¿¡æ¯
            use std::fs;
            match fs::read_to_string("/etc/os-release") {
                Ok(contents) => {
                    let id_line = contents.lines().find(|l| l.starts_with("PRETTY_NAME="));
                    match id_line {
                        Some(line) => line.trim_start_matches("PRETTY_NAME=").trim_matches('"').to_string(),
                        None => "Linux (Unknown distribution)".to_string(),
                    }
                }
                Err(_) => "Linux (Unable to read os-release)".to_string(),
            }
        }
    }

    // 3. ä½¿ç”¨æ¡ä»¶ç¼–è¯‘å¤„ç†è·¯å¾„åˆ†éš”ç¬¦ç­‰å·®å¼‚
    fn get_config_path() -> std::path::PathBuf {
        let mut path = dirs::config_dir().expect("Could not find config directory");
        // `join` æ–¹æ³•ä¼šä½¿ç”¨å½“å‰å¹³å°æ­£ç¡®çš„åˆ†éš”ç¬¦
        path.join("my_app").join("config.toml")
    }

    // 4. å¤„ç†æ§åˆ¶å°è¾“å‡ºé¢œè‰²ï¼ˆWindows CMDé»˜è®¤ä¸æ”¯æŒANSIé¢œè‰²ï¼‰
    fn print_colored(message: &str) {
        #[cfg(target_os = "windows")]
        {
            // åœ¨Windowsä¸Šï¼Œå¯å¯ç”¨è™šæ‹Ÿç»ˆç«¯åºåˆ—æˆ–ä½¿ç”¨ç‰¹å®šcrate
            // ä¾‹å¦‚å¯ç”¨è™šæ‹Ÿç»ˆç«¯ï¼ˆWindows 10+ï¼‰
            let _ = enable_vt_processing();
            print!("\x1b[32m{}\x1b[0m", message); // ç»¿è‰²
        }
        #[cfg(target_os = "linux")]
        {
            print!("\x1b[32m{}\x1b[0m", message); // ç»¿è‰²
        }
    }

    #[cfg(target_os = "windows")]
    fn enable_vt_processing() -> Result<(), Box<dyn Error>> {
        use windows_sys::Win32::System::Console::{GetStdHandle, SetConsoleMode, ENABLE_VIRTUAL_TERMINAL_PROCESSING, STD_OUTPUT_HANDLE};
        unsafe {
            let handle = GetStdHandle(STD_OUTPUT_HANDLE);
            let mut mode = 0;
            if SetConsoleMode(handle, ENABLE_VIRTUAL_TERMINAL_PROCESSING) != 0 {
                Ok(())
            } else {
                Err("Failed to enable VT processing".into())
            }
        }
    }

    fn main() -> Result<(), Box<dyn Error>> {
        println!("Hello from {}!", get_platform_info());
        println!("Config will be stored at: {:?}", get_config_path());
        print_colored("This is a colored message (if supported).\n");
        Ok(())
    }
    ```

3.  **ç®¡ç†è·¨å¹³å°ä¾èµ– (`Cargo.toml`)**ï¼š
    ```toml
    [package]
    name = "my_cross_platform_app"
    version = "0.1.0"
    edition = "2021"

    # é€šç”¨ä¾èµ–
    [dependencies]
    # ç”¨äºè·¨å¹³å°è·å–æ ‡å‡†ç›®å½•ï¼ˆå¦‚é…ç½®ç›®å½•ã€å®¶ç›®å½•ï¼‰
    dirs = "5"

    # Windows ç‰¹å®šä¾èµ–
    [target.'cfg(target_os = "windows")'.dependencies]
    windows-sys = { version = "0.48", features = ["Win32_System_Console"] }

    # Linux ç‰¹å®šä¾èµ– (ç¤ºä¾‹)
    # [target.'cfg(target_os = "linux")'.dependencies]
    # libc = "0.2"
    ```

### ğŸ”¨ ç¬¬ä¸‰æ­¥ï¼šè·¨å¹³å°ç¼–è¯‘ã€æµ‹è¯•ä¸åˆ†å‘

| ä»»åŠ¡ | åœ¨ WSL ç»ˆç«¯ä¸­æ‰§è¡Œçš„å‘½ä»¤ (é¡¹ç›®ç›®å½•ä¸‹) | è¾“å‡ºä¸è¯´æ˜ |
| :--- | :--- | :--- |
| **ä¸ºLinuxç¼–è¯‘ (æœ¬åœ°)** | `cargo build --release` (é»˜è®¤) | ç”Ÿæˆ `target/release/my_cross_platform_app` **(Linux ELFäºŒè¿›åˆ¶)** |
| **ä¸ºWindowsç¼–è¯‘ (äº¤å‰ç¼–è¯‘)** | `cargo build --release --target x86_64-pc-windows-gnu` | ç”Ÿæˆ `target/x86_64-pc-windows-gnu/release/my_cross_platform_app.exe` **(Windowså¯æ‰§è¡Œæ–‡ä»¶)** |
| **è¿è¡ŒLinuxæµ‹è¯•** | `cargo test` | åœ¨WSLçš„Linuxç¯å¢ƒä¸­è¿è¡Œæ‰€æœ‰æµ‹è¯•ã€‚ |
| **è¿è¡ŒWindowsæµ‹è¯•** | (éœ€åœ¨Windowsç¯å¢ƒï¼Œæˆ–ä½¿ç”¨Wine) `wine target/x86_64-pc-windows-gnu/release/my_cross_platform_app.exe` (éœ€å®‰è£…`wine`) | ä½¿ç”¨Wineæ¨¡æ‹Ÿå™¨è¿è¡ŒWindowsç¨‹åºè¿›è¡ŒåŸºæœ¬éªŒè¯ã€‚**å…³é”®æµ‹è¯•åº”åœ¨çœŸå®Windowsä¸­è¿›è¡Œã€‚** |

**æ„å»ºä¼˜åŒ–**ï¼šå¯ä»¥å°†å¸¸ç”¨å‘½ä»¤å†™å…¥ `package.json` ç±»ä¼¼çš„è„šæœ¬æ–‡ä»¶ï¼Œæˆ–ä½¿ç”¨ `just`ã€`make` ç­‰å·¥å…·æ¥ç®€åŒ–ã€‚

### ğŸ’¡ æ ¸å¿ƒå®è·µè¦ç‚¹æ€»ç»“

1.  **ç»Ÿä¸€ä»£ç ï¼Œæ¡ä»¶åˆ†æµ**ï¼šåšæŒä¸€ä»½ä»£ç ä»“åº“ï¼Œç”¨ `#[cfg]` ç®¡ç†å·®å¼‚ã€‚
2.  **æŠ½è±¡å¹³å°å±‚**ï¼šå¯¹äºå¤æ‚å¹³å°äº¤äº’ï¼Œåˆ›å»º `platform/` æ¨¡å—ï¼Œå†…éƒ¨ç”¨ `windows.rs` å’Œ `linux.rs` å®ç°ç›¸åŒ traitã€‚
3.  **å–„ç”¨è·¨å¹³å°Crate**ï¼šä¾‹å¦‚ `which` (æŸ¥æ‰¾ç¨‹åº)ã€`path-slash` (è·¯å¾„æ ¼å¼åŒ–)ã€`ctrlc` (å¤„ç† Ctrl-C)ã€`tempfile` (ä¸´æ—¶æ–‡ä»¶) ç­‰ï¼Œå®ƒä»¬å·²å¸®ä½ å¤„ç†äº†å¹³å°ç»†èŠ‚ã€‚
4.  **æŒç»­é›†æˆ (CI) æ˜¯å…³é”®**ï¼šé…ç½® GitHub Actions æˆ– GitLab CIï¼Œ**è‡ªåŠ¨åœ¨ `windows-latest` å’Œ `ubuntu-latest` ä¸¤ä¸ªRunnerä¸Šç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•**ï¼Œè¿™æ˜¯ä¿è¯å…¼å®¹æ€§çš„æœ€å¯é æ–¹æ³•ã€‚

æŒ‰ç…§è¿™ä¸ªæµç¨‹ï¼Œå°±èƒ½é«˜æ•ˆåœ°å¼€å‘å‡ºçœŸæ­£å¥å£®çš„è·¨å¹³å°Ruståº”ç”¨ç¨‹åºã€‚