# WSL需要的OS条件
## Windows11
 - 默认支持WSL2,无需额外检查
 - 推荐版本: 22H2或更高, 以支持systemd和WSLg(GUI应用支持)

## Windows10
 - 最低要求: 1903版本(build18362)或更高
 - 推荐版本: 20H2或更高,以获得更好的性能和功能支持

# 查看系统版本
```cmd
Win + R 输入 winver
```

# 安装WSL2
## 方法一: 一键安装(推荐)
```powershell
# 1. 以管理员身份打开 PowerShell或 Windows Terminal.

# 2. 执行命令
    wsl --install
```
系统将自动
 - 启用WSL和虚拟机平台功能
 - 下载并安装最新WSL2内核
 - 安装默认的 Ubuntu 发行版(若无其他指定)

重启电脑以完成安装.

## 方法二: 手动安装
适合需要精确控制安装过程的高级用户.

### 1. 启用必要功能: 以管理员身份运行 PowerShell,执行:
```powershell
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```

### 2. 重启电脑
```powershell
shutdown /r /t 0
```

### 3. 安装WSL2内核更新
 - 下载并安装WSL2 Linux内核更新包
 - 按提示完成安装

### 4. 设置WSL2为默认版本:
```powershell
wsl --set-default-version 2

# 确认WSL是否安装成功,检查版本信息
wsl --version
```

# 安装 Ubuntu 22.04
22.04 LTS是长期支持版本,稳定且适合大多数开发场景.

## 方法一: 通过Microsoft Store安装

## 方法二: 通过命令行安装
 1. 在PowerShell中运行:
   ```powershell
   wsl --install -d Ubuntu-22.04
   ```
 2. 安装完成后, WSL将自动启动 Ubuntu 并提示设置用户名和密码.
>注意:
 - 用户名和密码仅用于 Ubuntu 内部,与 Windows账户无关.
 - 若 Microsoft Store访问受限,推荐使用命令行方式.

# 管理存储: 默认位置与自定义迁移 ( C盘 -> D盘 )

WSL2的虚拟硬盘文件(.vhdx)默认占用系统盘空间, 可能导致C盘空间不足. 需要迁移到其他盘上.

## 默认存储位置
```makefile
C:\Users\<用户名>\AppData\Local\Packages\CanonicalGroupLimited...UbuntuonWindows_...
```
 - 包含一个扩展名为 .vhdx的虚拟硬盘文件, 存储 Ubuntu 的完整文件系统.
 - 默认占用空间约为1-2GB,随使用逐渐增长.

## 自定义存储位置
### 通过导出和导入操作, 可将 Ubuntu 迁移到其他磁盘.

### 1. 导出 Ubuntu 发行版:
```bash
wsl --export Ubuntu-22.04 D:\WSL\Ubuntu2204_backup.tar
```
 ※ Ubuntu 22.04导出为 .tar 文件, 存储在 D:\WSL 目录.

### 2. 注销旧发行版
```bash
wsl --unregister Ubuntu-22.04
```
※ 删除旧的 Ubuntu 发行版, 释放C盘空间.

### 3. 导入到新位置:
```bash
wsl --import Ubuntu-22.04 D:\WSL\Ubuntu2204 D:\WSL\Ubuntu2204_backup.tar --version 2
```
 ※ 将 Ubuntu导入到 D:\WSL\Ubuntu2204 目录, 确保使用WSL2.

### 4. 验证迁移
```bash
wsl -l -v
```
>提示:
 - 迁移后,建议定期备份 .tar 文件以恢复.
 - 若需调整虚拟硬盘, 可使用 **wsl --manage**命令.

# WSL2 常用命令速查
|命令                                    |说明
|--                                      |--
| wsl --help                             | 查看完整命令列表
| wsl --list / -l                        | 列出所有已安装的发行版
| wsl --list --verbose / -l -v           | 显示详细信息(包括版本和默认发行版)
| wsl --set-version <发行版名> 2         | 将指定发行版切换到 WSL2
| wsl --set-default <发行版名>           | 设置默认运行的发行版
| wsl --set-default-version 2            | 设置新安装的发行版默认使用 WSL2
| wsl --shutdown                         | 关闭所有运行中的 WSL 实例
| wsl --terminate <发行版名>             | 强制终止指定发行版
| wsl --unregister <发行版名>            | 注销并删除指定发行版
| wsl --export <发行版名> <文件路径>     | 导出发行版到指定路径
| wsl --import <发行版名> <路径> <文件>  | 导入发行版到指定位置


# 性能优化: 配置 .wslconfig
## WSL2 的性能可以通过全局配置文件 .wslconfig 进行优化，文件位于：
## C:\Users\<用户名>\.wslconfig
## 若文件不存在,需手动创建.

## 推荐配置模板
```ini
[wsl2]
memory=6GB                 # 限制WSL2最大内存使用量， 避免占用过多宿主机资源
processors=4               # 指定 CPU 核心数，建议设为物理核心数的一半
swap=8GB                   # 交换空间大小，推荐为内存的1-2倍
swapFile=D:\WSL\swap.vhdx  # 自定义 swap 文件路径， 避免使用C盘
autoMemoryReclaim=true     # 自动回收未使用内存，提升宿主机性能
localhostForwarding=true   # 启用localhost端口转发，允许WSL2与windows共享localhost端口
guiApplications=true       # 启用 WSLg，支持运行Linux GUI应用（win11独有）
gpu=true                   # 启用 GPU 加速（需支持的 GPU 驱动），适合机器学习或图形密集型任务
# dns=8.8.8.8              # 使用 Google DNS，自定义DNS服务器，解决网络解析问题
networkingMode=mirrored    # mirrored:支持双栈网络(IPv4/IPv6)
# firewall=true            # 启用 WSL 防火墙集成，提升安全性
# autoProxy=true           # 自动使用 Windows 代理，适合科学上网场景
nestedVirtualization=true  # 启用嵌套虚拟化（适合运行 Docker 等），支持WSL2内运行虚拟机或容器
```

# 应用配置
#### 1.保存 .wslconfig文件
#### 2.执行： wsl --shutdown
#### 3.重新启动WSL或重启电脑

# Ubuntu内部配置： /etc/wsl.conf
/etc/wsl.conf 是WSL2发行版内部的配置文件， 用于控制挂载，网络和启动行为。

## 推荐配置模板
```ini
[boot]
systemd=true                            # 启用systemd(需win11 22H2以上)

[automount]
enabled=true                            # 启用win磁盘自动挂载
root=/mnt/                              # 设置挂载点路径，默认 /mnt/
options="metadata,umask=22,fmask=11"    # 挂载选项，如metadata启用文件权限映射

[network]
generateHosts=true                      # 是否生成 /etc/hosts 文件
generateResolvConf=false                # 是否自动生成 /etc/resolv.conf（设为false可自定义DNS）

[interop]
enabled=true                            # 启用windows和WSL之间的互操作性
appendWindowsPath=true                  # 将windows PATH 添加到WSL环境变量

[user]
default=<你的用户名>                    # 设置默认登陆用户
```

## 若需自定义DNS，可手动编辑 /etc/resolv.conf， 并确保 generateResolvConf=false。

# 如何彻底重置WSL?
### 1. 注销发行版: wsl --unregister Ubuntu-22.04
### 2. 关闭WSL:    wsl --shutdown
### 3. (可选)禁用WSL功能:
 - 控制面板 > 程序和功能 > 启用或关闭windows功能
 - 取消勾选 **适用于Linux的Windows子系统** 和 **虚拟机平台**
 - 重启后重新启用

# WSLg(GUI)无法运行
### 原因: win11 配置或驱动问题.
### 解决:
 - 确保系统为 win11, 且启用WSLg(.wslconfig中guiApplications=true)
 - 更新GPU驱动
 - 安装X11服务器(如 VcXsrv)作为备用.

# 扩展功能 与 进阶用法
## 使用Windows Terminal
## 运行GUI应用(WSLg)
    - win11支持WSLg,可直接运行Linux GUI应用(如 gedit, firefox)
    - 安装示例
        ```bash
        sudo apt update
        sudo apt install firefox
        firefox
        ```
## 在WSL2中运行Docker
 - 启用嵌套虚拟化(.wslconfig 中 nestedVirtualization=true)
 - 安装Docker Desktop并启用WSL2后端,或直接在Ubuntu中安装Docker CE.

## USB设备支持
 - WSL2支持USB设备(如串口设备)通过 usbipd-win
 - 安装说明:
    ```bash
    winget install usbipd-win
    usbipd wsl list
    usbipd wsl attach --busid <设备ID>
    ```
# 集成开发环境
 - 在WSL2中安装VS Code Server, 结合Windows的VS Code实现无缝开发.
 - 示例:
    ```bash

    curl -fsSL https://code-server.dev/install.sh | sh
    code-server

    ```

# 最后建议: 定期更新WSL2内核和Ubuntu软件包,保持系统安全性和性能最佳.
```bash
wsl --update
sudo apt update && sudo apt upgrade -y
```

